window.animeIds = "";

function countAnimeData(a, b, c) {
    $.ajax({
        url: a,
        method: b,
        dataType: "JSON",
        retries: 3,
        async: !0,
        data: {
            anime_id: c
        },
        success: function(a) {
            a.forEach(a => {
                $(".anime-spinner-" + a.anime_id).hide(), $(".actual-anime-" + a.anime_id).show(), 0 < a.ongoing_posts_views_count ? ($(".views-count-" + a.anime_id).text(" " + a.ongoing_posts_views_count.toLocaleString()), $(".comments-count-" + a.anime_id).text(" " + a.ongoing_posts_comments_count.toLocaleString())) : 0 < a.posts_views_count ? ($(".views-count-" + a.anime_id).text(" " + a.posts_views_count.toLocaleString()), $(".comments-count-" + a.anime_id).text(" " + (a.comments_count + a.comment_replies_count).toLocaleString())) : ($(".views-count-" + a.anime_id).text(" ?"), $(".comments-count-" + a.anime_id).text(" ?"))
            })
        },
        error: function() {
            $("[class*=anime-spinner-]").each(() => $(this).hide()), $("[class*=actual-anime-]").each(() => $(this).show()), $("[class*=views-count-]").each(() => $(this).text(" ?")), $("[class*=comments-count-]").each(() => $(this).text(" ?"))
        }
    })
}

function startCountAnimeData(a = location.href.replace(location.hash, "")) {
    parseInt($("#isDesktop").val()) && setTimeout(() => {
        const b = $("#dataCountUrl").val(),
            c = $("#dataCountUrl").attr("method");
        $.ajax({
            url: a,
            method: "GET",
            dataType: "JSON",
            retries: 3,
            async: !0,
            data: {
                need_json: !0
            },
            success: function(a) {
                Object.entries(a).forEach(([a, b]) => {
                    Object.entries(b.data).forEach(([a, b]) => {
                        window.animeIds += `${b.id_status??b.id},`
                    })
                }), countAnimeData(b, c, window.animeIds)
            },
            error: function() {}
        })
    }, 2e3)
}
startCountAnimeData();